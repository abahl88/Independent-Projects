---
title: "R Notebook"
output:
  pdf_document: default
  html_notebook: default
  html_document: default
---
Load and check Data

```{r}
# Loading packages
library(ggplot2) # visualization
library('randomForest') # classification algorithm
library(stringr)
library(missForest)
library(dplyr)
```

Import and combine Data

```{r}
train <- read.csv('C:/Users/Aditya/Documents/R/Projects/Titanic/train.csv', stringsAsFactors = F)
test  <- read.csv('C:/Users/Aditya/Documents/R/Projects/Titanic/test.csv', stringsAsFactors = F)

full  <- bind_rows(train, test) # bind training & test data

full[which(is.na(full$Survived)),2] <- 0 #addressing NA values due to combining of train and test datasets

full$Survived <- as.factor(full$Survived)
```

Metadata information

```{r}
# check data
str(full)
```


First few rows of the dataset
```{r}
head(full)
```


Survival Rates

```{r}
ggplot(train , aes(x = Survived)) + geom_bar()

table(train$Survived)

```


549 people persished , 342 survived



Missing Values
```{r}

sapply(full, function(full) sum(is.na(full)))


```
Above table shows the number of missing values in each feature. 263 observations are missing in Age and 1 in Fare.


imputing Blank values in Embarked
```{r}

which(full$Embarked == "")

full[c(62, 830),]

```

```{r}

embark_fare <- full %>%
  filter(PassengerId != 62 & PassengerId != 830)

ggplot(embark_fare, aes(x = Embarked, y = Fare, fill = factor(Pclass))) + geom_boxplot()



```

```{r}
full$Embarked[c(62, 830)] <- 'C'
```


Imputing missing value in Fare

```{r}

which(is.na(full$Fare))

```

```{r}

full[1044, ]

thirdclass <- full[full$Pclass == 3 & full$Embarked == 'S' ,  ]

ggplot(thirdclass , aes(Fare)) + geom_density()

median(thirdclass$Fare , na.rm = TRUE)

full$Fare[1044] <- median(thirdclass$Fare , na.rm = TRUE)

```

Imputing missing values in males Ages

```{r}
Male_Ages <- full[ which(is.na(full$Age)) & full$Sex == 'male' , ]

median(Male_Ages$Age , na.rm =  TRUE)

ggplot(Male_Ages , aes(Age)) + geom_density()

full$Age[is.na(full$Age) == TRUE & full$Sex == 'male'] <- median(Male_Ages$Age , na.rm =  TRUE)


```

Imputing missing values in females Ages

```{r}

Female_Ages <- full[ which(is.na(full$Age)) & full$Sex == 'female' , ]

median(Female_Ages$Age , na.rm =  TRUE)

ggplot(Female_Ages , aes(Age)) + geom_density()

full$Age[is.na(full$Age) == TRUE & full$Sex == 'female'] <- median(Female_Ages$Age , na.rm =  TRUE)

```


Feature Engineering
```{r}

# Grab title from passenger names
full$Title <- gsub('(.*, )|(\\..*)', '', full$Name)

# Show title counts by sex
table(full$Sex, full$Title)


```





Passerger Class and Survival
```{r}
ggplot(train , aes(x = Pclass , fill = factor(Survived))) + geom_bar(width = 0.5)
```
This graph shows that passengers in 3rd class had a low survival rate as compared to 1st class.


```{r}
ggplot(train, aes(Age,fill = factor(Survived))) +
    geom_histogram(binwidth = 5) + facet_grid(.~Sex)
```

This graph shows the age and gender distribution and their survival rate. We see that females had a far more chance to survive as compared to males

Split back to Train and test data

```{r}

train <- full[1:891,]
test <- full[892:1309,]

```



Converting to factor variables
```{r}

train$Sex <- as.factor(train$Sex)
train$Embarked <- as.factor(train$Embarked)


test$Sex <- as.factor(test$Sex)
test$Embarked <- as.factor(test$Embarked)



```




Check if there are any missing Values
```{r}

sapply(full, function(full) sum(is.na(full)))


```



Random Forest Model
```{r}
rf_model <- randomForest(factor(Survived) ~ Pclass + Sex + Age + SibSp + Parch + 
                                            Fare + Embarked , data = train )

## Look at variable importance:
round(importance(rf_model), 2)




```


Prediction

```{r}
# Predict using the test set
prediction <- predict(rf_model, test)

# Save the solution to a dataframe with two columns: PassengerId and Survived (prediction)
solution <- data.frame(PassengerID = test$PassengerId, Survived = prediction)

# Write the solution to file
write.csv(solution, file = 'rf_mod_Solution.csv', row.names = F)
```






